<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8">
<title>AURES Generátor LP (web)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
 body{font-family:Arial,Helvetica,sans-serif;background:#f5f5f5;margin:0;padding:20px;color:#222}
 h1{font-size:26px;margin-top:0}
 .row{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px}
 label{width:140px;font-weight:600}
 input,select{flex:1;padding:6px}
 select{min-width:220px}
 button{padding:10px 18px;cursor:pointer;background:#007ACC;color:#fff;border:none;border-radius:4px}
 #dropZone{border:2px dashed #888;padding:20px;text-align:center;margin-bottom:14px;background:#fff;border-radius:6px}
 #dropZone.drag{border-color:#000}
 #status{margin-top:14px;font-size:14px}
</style>
<!-- CDN knihovny -->
<script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip.min.js"></script>
<script src="https://unpkg.com/docxtemplater@3.41.2/build/docxtemplater.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>
<h1>AURES Generátor LP</h1>

<div id="dropZone">Přetáhni osobní PDF sem nebo <input type="file" id="fileInput" accept="application/pdf" style="display:inline"/></div>

<div class="row"><label>Jméno</label><input id="jmeno"/></div>
<div class="row"><label>Datum narození</label><input id="narozeni"/></div>
<div class="row"><label>Adresa</label><input id="adresa"/></div>
<div class="row"><label>PSČ</label><input id="psc"/></div>

<h3>Faktory a Kategorie (1–6)</h3>
<div id="factors"></div>

<div class="row"><label>Pobočka</label><select id="pobocka"></select></div>
<div class="row"><label>Pozice</label><input id="pozice"/></div>
<div class="row"><label>Konzultant</label><select id="konzultant"></select><input type="checkbox" id="remember"> <span>Zapamatovat</span></div>

<div class="row"><label>Pozice popis</label><select id="pozice_popis"></select></div>

<div class="row"><button id="genDocx">Generovat DOCX</button></div>
<p id="status"></p>

<script>
// constants, UI helpers, init, pdf loader unchanged...
// ...

// Generate
async function generateDocx(){
  if(!tplArrayBuffer){ alert('Nejdřív načti šablonu LP_template.docx'); return; }
  status('Generuji…');
  let doc;
  try{
    const arr = tplArrayBuffer instanceof ArrayBuffer ? new Uint8Array(tplArrayBuffer) : tplArrayBuffer;
    const zip = new PizZip(arr);
    // správné načtení docxtemplater constructor:
    const DocxT = window.docxtemplater?.default || window.docxtemplater || window.Docxtemplater;
    if(!DocxT){ throw new Error('docxtemplater ctor not found'); }
    doc = new DocxT(zip, { paragraphLoop: true, linebreaks: true, nullGetter: () => '' });
  } catch(e) {
    console.error(e);
    status('Chyba při inicializaci šablony', true);
    alert('Šablona se nedá načíst – zkontroluj verzi docxtemplater.');
    return;
  }
  // context filling...
  try{ doc.render(ctx); }
  catch(e){ console.error(e); status('Chyba při doplňování dat', true); alert('Chyba v šabloně nebo nevyplněná povinná pole.'); return; }
  // save
  try{ saveAs(doc.getZip().generate({type:'blob'}), `LP_${surname}.docx`); status('Hotovo – staženo'); }
  catch(e){ console.error(e); status('Stažení selhalo', true); alert('Nepodařilo se stáhnout soubor.'); }
}

</script>
</body>
</html>
